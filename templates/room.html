{% extends "base.html" %}

{% block content %}
<div class="message-box">
    <h2>Chat Room: {{code}}</h2>
    <div class="messages" id="messages"></div>
    <div class="inputs">
        <input type="text" rows="3" id="message-input" name="message" placeholder="Type your message here...">
        <button type="button" name="send" id="send-button" onClick="sendMessage()">Send</button>
    </div>
</div>
<script type="text/javascript">
    var socketio = io();

    const messages = document.getElementById('messages');
    
    const createMessage = (username, message) => {
        const content = 
            `<div class="text">
                <span>
                    <strong>${username}</strong>: ${message}
                    <!-- ${message} -->
                </span>
                <span class="muted">
                    ${new Date().toLocaleTimeString()}
                </span>
            </div>`;
            messages.innerHTML += content;
    };

    socketio.on('message', (data) => {
        console.log("Received message:", data);
        createMessage(data.username, data.message);
    });

    const sendMessage = () => {
        console.log("Sending message");
        const messageInput = document.getElementById('message-input');
        if (messageInput.value === '') {
            return;
        }
        socketio.emit('handle_message', {data: messageInput.value});
        messageInput.value = '';
    }
</script>
{% for msg in messages %}
    <script type="text/javascript">
        createMessage("{{msg.username}}", "{{msg.message}}");
    </script>
{% endfor %}
{% endblock %}